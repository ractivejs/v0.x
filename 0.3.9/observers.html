<!doctype html>
<html lang='en-GB'>
<head>
	<meta charset='utf-8'>
	<meta http-equiv='X-UA-Compatible' content='IE=Edge,chrome=1'>

	<title> Observers | Docs | Ractive.js </title >

	<meta name='viewport' content='width=device-width, initial-scale=1, maximum-scale=1'>

	<link rel='icon' type='image/png' href='../assets/favicon.png'>
	<link rel='stylesheet' href='../min.css'>

	<!--[if lte IE 8]>
		<script src='../assets/respond.min.js'></script>
		<script src='../assets/html5shiv.min.js'></script>
	<![endif]-->

</head>

<body class='example'>

	<nav>
	<div class='nav-inner'>
		<a href='http://ractivejs.org'>Ractive.js</a>

		<ul>
			<li><a href='http://ractivejs.org/60-second-setup'>60 second setup</a></li>
			<li><a href='http://learn.ractivejs.org'>Tutorials</a></li>
			<li><a href='http://examples.ractivejs.org'>Examples</a></li>
			<li class="selected"><a href='http://docs.ractivejs.org'>Docs</a></li>
			<li><a href='http://docs.ractivejs.org/latest/plugins'>Plugins</a></li>
			<li><a href='http://blog.ractivejs.org'>Blog</a></li>
			<li class='github-small'><a href='https://github.com/ractivejs/ractive'>GitHub</a></li>
		</ul>

		<a class='github-wide' href='https://github.com/ractivejs/ractive'>GitHub</a>

		<button id='nav-toggle'>&#9776;</button>
	</div>
</nav>


	<main>
		<div class='content'>
			<header class='main-header'>
				<h1>Observers</h1>
				<a class='edit-link' href='https://github.com/ractivejs/docs.ractivejs.org/edit/master/docs/0.3.9/Observers.md.hbs'>edit this page</a>
			</header>

			<h2 id="like-publish-subscribe-but-different">Like publish/subscribe, but different</h2>
<p>A common pattern in modern JavaScript is to make models <em>observable</em>, using the traditional <a href="http://addyosmani.com/blog/understanding-the-publishsubscribe-pattern-for-greater-javascript-scalability/">publish/subscribe</a> mechanism.</p>
<p>For example, you can observe changes to attributes within a Backbone Model like so:</p>
<pre><code class="language-js">model = Backbone.Model({ myValue: <span class="number">1</span> });

model.on( <span class="string">'change:myValue'</span>, <span class="function"><span class="keyword">function</span> <span class="params">( model, value, options )</span> {</span>
  alert( <span class="string">'myValue changed to '</span> + value );
});

model.set( <span class="string">'myValue'</span>, <span class="number">2</span> ); <span class="comment">// alerts 'myValue changed to 2'</span></code></pre>
<p>This works because <code>Backbone.Model.prototype</code> inherits from <code>Backbone.Events</code>.</p>
<p>Ractive implements pub/sub with <a href="ractive-on">ractive.on()</a>, <a href="ractive-off">ractive.off()</a> and <a href="ractive-fire">ractive.fire()</a> - see <a href="events">Events</a> for more info.</p>
<h2 id="observing-models-with-nested-properties">Observing models with nested properties</h2>
<p>But the normal pub/sub mechanism won&#39;t work for monitoring data changes with Ractive, because our data can contain nested properties. It&#39;s no good subscribing to a <code>change:foo.bar</code> event, if <code>foo.bar</code> can change as a result of <code>foo</code> changing.</p>
<p>So instead, we introduce the concept of <em>observers</em>.</p>
<p>An observer observes a particular <a href="keypaths">keypath</a>, and is <em>notified</em> when the value of its keypath changes, whether directly or indirectly (because an <em>upstream</em> or <em>downstream</em> keypath changed). You create one with <code>ractive.observe()</code>.</p>
<p>Here&#39;s an example:</p>
<pre><code class="language-js">ractive = <span class="keyword">new</span> Ractive({
  el: myContainer,
  template: myTemplate,
  data: {
    foo: { bar: <span class="number">1</span> }
  }
});

<span class="comment">// The observer will be initialised with ( currentValue, undefined ) unless</span>
<span class="comment">// we pass a third `options` argument in which `init` is `false`. In other</span>
<span class="comment">// words this will alert 'foo.bar changed to 1'</span>
observer = ractive.observe( <span class="string">'foo.bar'</span>, <span class="function"><span class="keyword">function</span> <span class="params">( newValue, oldValue, keypath )</span> {</span>
  alert( keypath + <span class="string">' changed to '</span> + newValue );
});

ractive.set( <span class="string">'foo.bar'</span>, <span class="number">2</span> ); <span class="comment">// alerts 'foo.bar changed to 2'</span>
ractive.get( <span class="string">'foo'</span> ); <span class="comment">// returns { bar: 2 }</span>

ractive.set( <span class="string">'foo'</span>, { bar: <span class="number">3</span> }); <span class="comment">// alerts 'foo.bar changed to 3'</span>
ractive.get( <span class="string">'foo.bar'</span> ); <span class="comment">// returns 3</span>

observer.cancel();

ractive.set( <span class="string">'foo.bar'</span>, <span class="number">4</span> ); <span class="comment">// alerts nothing; the observer was cancelled</span></code></pre>
<p>Observers are most useful in the context of <a href="two-way-binding">two‚Äêway binding</a>.</p>
<h2 id="a-gotcha-to-be-aware-of">A &#39;gotcha&#39; to be aware of</h2>
<p>Observers will be notified whenever the new value is not equal to the old value - <em>sort of</em>.</p>
<p>What does &#39;not equal&#39; mean? Well, with <em>primitive values</em> such as strings and numbers, that&#39;s easy - they&#39;re either identical (in the <code>===</code> sense) or they&#39;re not.</p>
<p>With objects and arrays (hereafter, just &#39;objects&#39;, since that&#39;s what arrays technically are), it&#39;s not so straightforward:</p>
<pre><code class="language-js">a = { one: <span class="number">1</span>, two: <span class="number">2</span>, three: <span class="number">3</span> };
b = { one: <span class="number">1</span>, two: <span class="number">2</span>, three: <span class="number">3</span> };

alert( a === b ); <span class="comment">// alerts 'false' - they look the same, but they ain't</span>

b = a;
b.four = <span class="number">4</span>;

alert( a === b ); <span class="comment">// alerts 'true'. Hang on, `a` didn't have a 'four' property?</span>
alert( a.four ); <span class="comment">// alerts '4'. Oh. Right.</span></code></pre>
<p>So one the one hand, objects which look identical aren&#39;t. On the other, you can set a property of an object and have no idea whether doing so resulted in a change.</p>
<p>There are two possible responses to this problem. First, we could do a &#39;deep clone&#39; of an object whenever we do <code>ractive.set(keypath, object)</code>, using an algorithm similar to <a href="http://api.jquery.com/jQuery.extend/#jQuery-extend-deep-target-object1-objectN">jQuery extend</a>. That would mean any references you held to <code>object</code> would become irrelevant. It would also mean a whole load of extra computation, and probably some very strange behaviour with cyclical data structures. No thanks.</p>
<p>The second is to sidestep the issue, and simply state that for the purposes of determining whether to notify observers, <strong>no two objects are equal, even when they&#39;re identical</strong> (unless they&#39;re both <code>null</code>, of course - since <code>typeof null === &#39;object&#39;</code> due to a <a href="http://www.2ality.com/2013/10/typeof-null.html">bug in the language</a>).</p>
<p>This is the safest, sanest behaviour, but it can lead to unexpected behaviour in one situation - accessing properties within an observer:</p>
<pre><code class="language-js">obj = { a: { b: { c: <span class="number">1</span> } } };

ractive = <span class="keyword">new</span> Ractive({
  el: myContainer,
  template: myTemplate,
  data: { obj: obj }
});

<span class="comment">// We observe 'obj.a.b.c' indirectly, and directly</span>
ractive.observe({
  <span class="string">'obj'</span>: <span class="function"><span class="keyword">function</span> <span class="params">( newObj, oldObj )</span> {</span>
    alert( <span class="string">'Indirect observer: changed from '</span> + oldObj.a.b.c + <span class="string">' to '</span> + newObj.a.b.c );
  },
  <span class="string">'obj.a.b.c'</span>: <span class="function"><span class="keyword">function</span> <span class="params">( newC, oldC )</span> {</span>
    alert( <span class="string">'Direct observer: changed from '</span> + oldC + <span class="string">' to '</span> + newC );
  }
});

obj.a.b.c = <span class="number">2</span>;

<span class="comment">// The next line will cause two alerts:</span>
<span class="comment">//   'Direct observer: changed from 1 to 2'</span>
<span class="comment">//   'Indirect observer: changed from 2 to 2' - because oldObj === newObj</span>
ractive.set( <span class="string">'obj'</span>, obj );</code></pre>
<p>This is definitely an edge case, but one that it&#39;s worth being aware of.</p>

		</div>

		<aside class="left-nav">
			<section>
	<h1>Introduction</h1>
	<ul>
		<li><a href="get-started">Get started</a></li>
		<li><a href="get-support">Get support</a></li>
		<li><a href="contributing">Contributing</a></li>
	</ul>
</section>

<section>
	<h1>API Reference</h1>
	<h2>new Ractive(...)</h2>
	<ul>
		<li><a href="initialisation-options">Initialisation options</a></li>
	</ul>

	<h2>Instance methods</h2>
	<ul>
		<li><a href="ractive-animate">ractive.animate()</a></li>
		<li><a href="ractive-find">ractive.find()</a></li>
		<li><a href="ractive-findall">ractive.findAll()</a></li>
		<li><a href="ractive-fire">ractive.fire()</a></li>
		<li><a href="ractive-get">ractive.get()</a></li>
		<li><a href="ractive-merge">ractive.merge()</a></li>
		<li><a href="ractive-observe">ractive.observe()</a></li>
		<li><a href="ractive-off">ractive.off()</a></li>
		<li><a href="ractive-on">ractive.on()</a></li>
		<li><a href="ractive-set">ractive.set()</a></li>
		<li><a href="ractive-teardown">ractive.teardown()</a></li>
		<li><a href="ractive-tohtml">ractive.toHTML()</a></li>
		<li><a href="ractive-update">ractive.update()</a></li>
		<li><a href="ractive-updatemodel">ractive.updateModel()</a></li>
	</ul>

	<h2>Instance properties</h2>
	<ul>
		<li><a href="ractive-nodes">ractive.nodes</a></li>
		<li><a href="ractive-transitions-instance">ractive.transitions</a></li>
		<li><a href="ractive-partials-instance">ractive.partials</a></li>
	</ul>

	<h2>Static methods</h2>
	<ul>
		<li><a href="ractive-parse">Ractive.parse()</a></li>
		<li><a href="ractive-extend">Ractive.extend()</a></li>
	</ul>

	<h2>Static properties</h2>
	<ul>
		<li><a href="ractive-defaults">Ractive.defaults</a></li>
	</ul>
</ul>

<section>
	<h1>Plugins</h1>
	<ul>
		<li><a href="plugins">List of plugins</a></li>
		<li><a href="writing-plugins">Writing plugins</a></li>
	</ul>
</section>

<section>
	<h1>Glossary</h1>
	<ul>
		<li><a href="adaptors">Adaptors</a></li>
		<li><a href="array-modification">Array modification</a></li>
		<li><a href="components">Components</a></li>
		<li><a href="decorators">Decorators</a></li>
		<li><a href="dependants">Dependants</a></li>
		<li><a href="expressions">Expressions</a></li>
		<li><a href="events">Events</a></li>
		<li><a href="keypaths">Keypaths</a></li>
		<li><a href="magic-mode">Magic mode</a></li>
		<li><a href="mustaches">Mustaches</a></li>
		<li><a href="observers">Observers</a></li>
		<li><a href="parallel-dom">Parallel DOM</a></li>
		<li><a href="partials">Partials</a></li>
		<li><a href="references">References</a></li>
		<li><a href="templates">Templates</a></li>
		<li><a href="transitions">Transitions</a></li>
		<li><a href="two-way-binding">Two-way binding</a></li>
	</ul>
</section>

<section>
	<h1>Specific versions</h1>

	<ul>
		<li><a href='../edge'>edge</a></li>
		<li><a href='../0.7'>0.7</a></li>
		<li><a href='../0.6'>0.6</a></li>
		<li><a href='../0.5'>0.5</a></li>
		<li><a href='../0.4.0'>0.4.0</a></li>
		<li><a href='../0.3.9'>0.3.9</a></li>
	</ul>
</section>

		</aside>
	</main>

	<footer>
	<p>Ractive.js is a free and open source project released under the MIT license.</p>
</footer>


	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-5602942-6', 'ractivejs.org');
	ga('send', 'pageview');
</script>


	<script src='../assets/nav.js'></script>

</body>
</html>
