<!doctype html>
<html lang='en-GB'>
<head>
	<meta charset='utf-8'>
	<meta http-equiv='X-UA-Compatible' content='IE=Edge,chrome=1'>

	<title> Writing event plugins | Docs | Ractive.js </title >

	<meta name='viewport' content='width=device-width'>

	<link rel='icon' type='image/png' href='../assets/favicon.png'>
	<link rel='stylesheet' href='../min.css'>

	<!--[if lte IE 8]>
		<script src='../assets/respond.min.js'></script>
		<script src='../assets/html5shiv.min.js'></script>
	<![endif]-->

</head>

<body class='example'>

	<nav>
	<div class='nav-inner'>
		<a href='http://ractivejs.org'>Ractive.js</a>

		<ul>
			<li><a href='http://ractivejs.org/60-second-setup'>60 second setup</a></li>
			<li><a href='http://learn.ractivejs.org'>Tutorials</a></li>
			<li><a href='http://examples.ractivejs.org'>Examples</a></li>
			<li class="selected"><a href='http://docs.ractivejs.org'>Docs</a></li>
			<li><a href='http://docs.ractivejs.org/latest/plugins'>Plugins</a></li>
			<li><a href='http://blog.ractivejs.org'>Blog</a></li>
			<li class='github-small'><a href='https://github.com/ractivejs/ractive'>GitHub</a></li>
		</ul>

		<a class='github-wide' href='https://github.com/ractivejs/ractive'>GitHub</a>

		<button id='nav-toggle'>&#9776;</button>
	</div>
</nav>


	<main>
		<div class='content'>
			<header class='main-header'>
				<h1>Writing event plugins</h1>
				<a class='edit-link' href='https://github.com/ractivejs/docs.ractivejs.org/edit/master/docs/0.7/Writing event plugins.md.hbs'>edit this page</a>
			</header>

			<p>If you&#39;re using <a href="events#on-events">proxy events</a>, you can either use the standard DOM events that an element can listen to (e.g. <code>click</code>, <code>mouseover</code>, <code>touchmove</code>, <code>load</code>, whatever) or you can use custom event definitions.</p>
<p>These allow you to define more complex events than the native ones, but still treat them as first class citizens. For example the <code>tap</code> event abstracts away differences between mouse and touch interfaces, eliminating the 300ms delay users would experience on a touch device if you were only listening for <code>click</code> events:</p>
<pre><code class="language-html">&lt;a class=&#39;button&#39; on-tap=&#39;select&#39;&gt;Tap me!&lt;/a&gt;</code></pre>
<p>You could also use the event definition API to normalise browser behaviour (e.g. with <code>mouseenter</code> and <code>mouseleave</code>, which are handy and widely-used events, but non-standard ones), or to implement swiping and other gestures.</p>
<p>Future versions of Ractive may include more event definitions &#39;out of the box&#39; - for now, there is just the <code>tap</code> event.</p>
<h2 id="the-event-definition-api">The event definition API</h2>
<p>When Ractive sees a <code>on-[eventName]</code> directive, it first looks in <code>Ractive.events</code> for an <code>[eventName]</code> property, and if it finds one it <em>applies the definition</em>. (If not, it assumes that <code>[eventName]</code> refers to a native DOM event.)</p>
<p>Event definitions receive two arguments - <code>node</code>, and <code>fire</code>. <code>node</code> is the element to which the definition is being applied, and <code>fire</code> is the function that must be called when the event has taken place.</p>
<h3 id="-fire-when-ready"><code>fire</code> when ready</h3>
<p>The <code>fire</code> function takes a single argument which is the <code>event</code> object received by handlers. It will be augmented with <code>context</code>, <code>keypath</code> and <code>index</code> properties (TODO: explain these).</p>
<p>To be consistent with &#39;native&#39; proxy events, the <code>event</code> object must have a <code>node</code> property (that&#39;s right, you pass the reference back - this allows us to reuse handlers with many different elements, without penalty), and if applicable an <code>original</code> property which should be an underlying DOM event.</p>
<p>You can add as many other properties as you like, however (swipe start position, long press duration, whether the user is currently standing on their head, whatever you like).</p>
<h3 id="the-event-definition-return-value">The event definition return value</h3>
<p>Event definitions should return an object with a <code>teardown</code> property, which is a function that removes any DOM event handlers that were bound as part of the setup (and undoes any other changes that were applied).</p>
<h3 id="an-example">An example</h3>
<p>All this will make more sense with an example. Let&#39;s define a <code>menu</code> event, which will allow us to insert our own custom menu.</p>
<p>If the user is using a mouse, we want to intercept the <code>contextmenu</code> event (which is generally fired on right-click). On touch devices, we&#39;ll use a long press to signal that the user wants to open the menu, as that is a common interaction within apps.</p>
<pre><code class="language-js">Ractive.events.menu = <span class="function"><span class="keyword">function</span> <span class="params">( node, fire )</span> {</span>
  <span class="keyword">var</span> longpressDuration = <span class="number">500</span>, threshold = <span class="number">5</span>, contextmenuHandler, touchstartHandler;

  <span class="comment">// intercept contextmenu events and suppress them</span>
  contextmenuHandler = <span class="function"><span class="keyword">function</span> <span class="params">( event )</span> {</span>
    event.preventDefault();

    <span class="comment">// we'll pass along some coordinates. This will make more sense below</span>
    fire({
      node: node,
      original: event,
      x: event.clientX,
      y: event.clientY
    });
  };

  node.addEventListener( <span class="string">'contextmenu'</span>, contextmenuHandler );

  <span class="comment">// that was easy! but touch is a little more complicated</span>
  touchstartHandler = <span class="function"><span class="keyword">function</span> <span class="params">( event )</span> {</span>
    <span class="keyword">var</span> touches, touch, finger, startX, startY, moveHandler, cancel, timeout;

    <span class="comment">// for simplicity, we'll only deal with single finger presses</span>
    <span class="keyword">if</span> ( event.touches.length !== <span class="number">1</span> ) {
      <span class="keyword">return</span>;
    }

    <span class="comment">// suppress the default behaviour</span>
    event.preventDefault();

    <span class="comment">// we'll need this info later</span>
    touch = event.touches[<span class="number">0</span>];
    finger = touch.identifier;
    startX = touch.clientX;
    startY = touch.clientY;

    <span class="comment">// after the specified delay, fire the event...</span>
    timeout = setTimeout( <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
      <span class="comment">// there is no underlying event we could meaningfully pass on. but</span>
      <span class="comment">// we can pass along some coordinates</span>
      fire({
        node: node,
        x: startX,
        y: startY
      });
      cancel();
    }, longpressDuration );

    <span class="comment">// ...unless the timeout is cancelled</span>
    cancel = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
      clearTimeout( timeout );

      <span class="comment">// tidy up after ourselves</span>
      window.removeEventListener( <span class="string">'touchmove'</span>, touchmoveHandler );
      window.removeEventListener( <span class="string">'touchend'</span>, cancel );
      window.removeEventListener( <span class="string">'touchcancel'</span>, cancel );
    };

    <span class="comment">// if the user moves their finger, test whether they've moved it beyond a</span>
    <span class="comment">// certain threshold or if they've left the target element</span>
    touchmoveHandler = <span class="function"><span class="keyword">function</span> <span class="params">( event )</span> {</span>
      <span class="keyword">var</span> touch, currentTarget;

      <span class="comment">// find the right touch (another finger may have touched the screen)</span>
      i = event.touches.length;
      <span class="keyword">while</span> ( i-- ) {
        <span class="keyword">if</span> ( event.touches[i].identifier === finger ) {
          touch = event.touches[i];
          <span class="keyword">break</span>;
        }
      }

      <span class="keyword">if</span> ( !touch ) {
        cancel();
        <span class="keyword">return</span>;
      }

      dx = touch.clientX - startX;
      dy = touch.clientY - startY;
      currentTarget = document.elementFromPoint( touch.clientX, touch.clientY );

      <span class="comment">// if the finger has moved too far, or is no longer over the target, cancel</span>
      <span class="keyword">if</span> ( Math.abs( dx ) &gt; threshold || Math.abs( dy ) &gt; threshold || !el.contains( currentTarget ) ) {
        cancel();
      }
    };

    window.addEventListener( <span class="string">'touchmove'</span>, touchmoveHandler );
    window.addEventListener( <span class="string">'touchend'</span>, cancel );
    window.addEventListener( <span class="string">'touchcancel'</span>, cancel );
  };

  node.addEventListener( <span class="string">'touchstart'</span>, touchstartHandler );

  <span class="comment">// return an object with a teardown method, so we can unbind everything when the</span>
  <span class="comment">// element is removed from the DOM</span>
  <span class="keyword">return</span> {
    teardown: <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
      node.removeEventListener( <span class="string">'contexmenu'</span>, contextmenuHandler );
      node.removeEventListener( <span class="string">'touchstart'</span>, touchstartHandler );
    }
  };
};</code></pre>
<p>You can now use the <code>menu</code> event in Ractive instances:</p>
<pre><code class="language-html">&lt;div on-menu=&#39;showMenu&#39;&gt;This element has its own context menu&lt;/div&gt;</code></pre>
<pre><code class="language-js">ractive = <span class="keyword">new</span> Ractive({
  el: myContainer,
  template: myTemplate
});

ractive.on( <span class="string">'showMenu'</span>, <span class="function"><span class="keyword">function</span> <span class="params">( event )</span> {</span>
  <span class="comment">// show menu at client coordinates event.x, event.y</span>
});</code></pre>

		</div>

		<aside class="left-nav">
			<section>
	<h1>Introduction</h1>
	<ul>
		<li><a href="get-started">Get started</a></li>
		<li><a href="tips">Tips</a></li>
		<li><a href="get-support">Get support</a></li>
		<li><a href="contributing">Contributing</a></li>
		<li><a href="get-started-with-node-js">Get started with node.js</a></li>
		<li><a href="migrating">Migrating from previous versions</a></li>
	</ul>
</section>

<section>
	<h1>Configuration</h1>
	<ul>
		<li><a href="options">Options</a></li>
		<li><a href="ractive-defaults">Defaults</a></li>
		<li><a href="advanced-configuration">Advanced configuration</a></li>
	</ul>
</section>
<section>
	<h1>Core Concepts</h1>
	<h2>Templates</h2>
	<ul>
		<li><a href="templates">Templates</a></li>
		<li><a href="mustaches">Mustaches</a></li>
		<li><a href="references">References</a></li>
		<li><a href="expressions">Expressions</a></li>
		<li><a href="keypaths">Keypaths</a></li>
		<li><a href="partials">Partials</a></li>
		<li><a href="decorators">Decorators</a></li>
	</ul>
	<h2>Data & Binding</h2>
	<ul>
		<li><a href="two-way-binding">Two-way binding</a></li>
		<li><a href="magic-mode">Magic mode</a></li>
		<li><a href="dependants">Dependants</a></li>
		<li><a href="array-modification">Array modification</a></li>
		<li><a href="computed-properties">Computed Properties</a></li>
		<li><a href="observers">Observers</a></li>
		<li><a href="adaptors">Adaptors</a></li>
		<li><a href="parallel-dom">Parallel DOM</a></li>
	</ul>
	<h2>Events</h2>
	<ul>
		<li><a href="events-overview">Overview</a></li>
		<li><a href="event-directives">Event directives</a></li>
		<li><a href="proxy-events">Proxy events</a></li>
		<li><a href="method-calls">Method calls</a></li>
		<li><a href="publish-subscribe">Publish/subscribe</a></li>
		<li><a href="event-bubbling">Event bubbling</a></li>
		<li><a href="lifecycle-events">Lifecycle events</a></li>
	</ul>
	<h2>Transitions and Animations</h2>
	<ul>
		<li><a href="transitions">Transitions</a></li>
		<li><a href="promises">Promises</a></li>
		<li><a href="ractive-easing">Easings</a></li>
	</ul>
	<h2>Components</h2>
	<ul>
		<li><a href="components">Components</a></li>
	</ul>
</section>
<section>
	<h1>API Reference</h1>
	<h2>Constructor</h2>
	<ul>
		<li><a href="new-ractive">new Ractive(...)</a></li>
	</ul>
	<h2>Instance methods</h2>
	<ul>
		<li><a href="ractive-add">ractive.add()</a></li>
		<li><a href="ractive-animate">ractive.animate()</a></li>
		<li><a href="ractive-detach">ractive.detach()</a></li>
		<li><a href="ractive-find">ractive.find()</a></li>
		<li><a href="ractive-findall">ractive.findAll()</a></li>
		<li><a href="ractive-findallcomponents">ractive.findAllComponents()</a></li>
		<li><a href="ractive-findcomponent">ractive.findComponent()</a></li>
		<li><a href="ractive-findcontainer">ractive.findContainer()</a></li>
		<li><a href="ractive-findparent">ractive.findParent()</a></li>
		<li><a href="ractive-fire">ractive.fire()</a></li>
		<li><a href="ractive-get">ractive.get()</a></li>
		<li><a href="ractive-insert">ractive.insert()</a></li>
		<li><a href="ractive-merge">ractive.merge()</a></li>
		<li><a href="ractive-observe">ractive.observe()</a></li>
		<li><a href="ractive-observeonce">ractive.observeOnce()</a></li>
		<li><a href="ractive-off">ractive.off()</a></li>
		<li><a href="ractive-on">ractive.on()</a></li>
		<li><a href="ractive-once">ractive.once()</a></li>
		<li><a href="ractive-pop">ractive.pop()</a></li>
		<li><a href="ractive-push">ractive.push()</a></li>
		<li><a href="ractive-render">ractive.render()</a></li>
		<li><a href="ractive-reset">ractive.reset()</a></li>
		<li><a href="ractive-resetpartial">ractive.resetPartial()</a></li>
		<li><a href="ractive-set">ractive.set()</a></li>
		<li><a href="ractive-shift">ractive.shift()</a></li>
		<li><a href="ractive-splice">ractive.splice()</a></li>
		<li><a href="ractive-subtract">ractive.subtract()</a></li>
		<li><a href="ractive-teardown">ractive.teardown()</a></li>
		<li><a href="ractive-toggle">ractive.toggle()</a></li>
		<li><a href="ractive-tohtml">ractive.toHTML()</a></li>
		<li><a href="ractive-unrender">ractive.unrender()</a></li>
		<li><a href="ractive-unshift">ractive.unshift()</a></li>
		<li><a href="ractive-update">ractive.update()</a></li>
		<li><a href="ractive-updatemodel">ractive.updateModel()</a></li>
	</ul>
	<h2>Instance properties</h2>
	<ul>
		<li><a href="ractive-container">ractive.container</a></li>
		<li><a href="ractive-nodes">ractive.nodes</a></li>
		<li><a href="ractive-transitions-instance">ractive.transitions</a></li>
		<li><a href="ractive-parent">ractive.parent</a></li>
		<li><a href="ractive-partials-instance">ractive.partials</a></li>
		<li><a href="ractive-root">ractive.root</a></li>
	</ul>
	<h2>Static methods</h2>
	<ul>
		<li><a href="ractive-extend">Ractive.extend()</a></li>
		<li><a href="ractive-getnodeinfo">Ractive.getNodeInfo()</a></li>
		<li><a href="ractive-parse">Ractive.parse()</a></li>
	</ul>
	<h2>Static properties</h2>
	<ul>
		<li><a href="ractive-defaults">Ractive.defaults</a></li>
		<li><a href="ractive-easing">Ractive.easing</a></li>
	</ul>
</ul>
</section>
<section>
	<h1>Plugins</h1>
	<h2>Using</h2>
	<ul>
		<li><a href="plugins">List of plugins</a></li>
	</ul>
	<h2>Writing</h2>
	<ul>
		<li><a href="writing-adaptor-plugins">Adaptors</a></li>
		<li><a href="writing-decorator-plugins">Decorators</a></li>
		<li><a href="writing-event-plugins">Events</a></li>
		<li><a href="writing-transition-plugins">Transitions</a></li>
	</ul>
</section>

<section>
	<h1>Specific versions</h1>

	<ul>
		<li><a href='../edge'>edge</a></li>
		<li><a href='../0.7'>0.7</a></li>
		<li><a href='../0.6'>0.6</a></li>
		<li><a href='../0.5'>0.5</a></li>
		<li><a href='../0.4.0'>0.4.0</a></li>
		<li><a href='../0.3.9'>0.3.9</a></li>
	</ul>
</section>

		</aside>
	</main>

	<footer>
	<p>Ractive.js is a free and open source project released under the MIT license.</p>
</footer>


	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-5602942-6', 'ractivejs.org');
	ga('send', 'pageview');
</script>


	<script src='../assets/nav.js'></script>

</body>
</html>
